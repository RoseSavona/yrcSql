<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
		<title>军事理论考试系统</title>
		<link rel="stylesheet" href="../layui/css/layui.css">
		<script src="../assets/js/jquery-3.5.1.min.js"></script>
		<script src="../assets/js/jquery.cookie.js"></script>
		<script src="../assets/js/jquery.md5.js"></script>
		<!--<script src="../assets/js/main.js"></script>-->

		<!--测试用，记得注释掉-->
		<!--<script src="../assets/js/mock.js"></script>-->
		<!--<script src="../mockjs/mock.js"></script>-->
	</head>
	<body>
		<div class="layui-layout layui-layout-admin">
			<div class="layui-header">
				<div class="layui-logo">军事理论考试系统</div>
				<!-- 头部区域（可配合layui已有的水平导航） -->
				<ul class="layui-nav layui-layout-left">
					<li class="layui-nav-item layui-this"><a href="">主页</a></li>
					<li class="layui-nav-item"><a href="./admin.html">管理员</a></li>
					<li class="layui-nav-item"><a href="./teacher.html">老师</a></li>
					<li class="layui-nav-item"><a href="./student.html">学生</a></li>
				</ul>
				<ul class="layui-nav layui-layout-right">
					<li id="user-info" class="layui-nav-item layui-hide">
						<a href="javascript:;">个人中心</a>
						<dl class="layui-nav-child"> <!-- 二级菜单 -->
							<dd><a id="user-name" href="./student.html"></a></dd>
							<dd><a id="logout" href="#">退出</a></dd>
						</dl>
					</li>
					<li  id="login"class="layui-nav-item layui-hide">
						<a  href="#">登录</a>
					</li>
				</ul>
			</div>

			<div class="layui-side layui-bg-black">
				<div class="layui-side-scroll">
					<!-- 左侧导航区域（可配合layui已有的垂直导航） -->
					<ul class="layui-nav layui-nav-tree"  lay-filter="left-nav">
						<li  class="layui-nav-item layui-this"><a id="teacher-msg" href="#">考试通知</a></li>
						<li id="admin-msg" class="layui-nav-item"><a id="admin-msg" href="#">管理员通知</a></li>
					</ul>
				</div>
			</div>

			<div id="main-info" class="layui-body" >
				<!-- 内容主体区域 -->
				<div id="teacher-info" class="layui-collapse">
					<div class="layui-colla-item">
						<h2 class="layui-colla-title">关于考试安排</h2>
						<div class="layui-colla-content layui-show">........</div>
					</div>
					<div class="layui-colla-item">
						<h2 class="layui-colla-title">考生须知</h2>
						<div class="layui-colla-content">内容区域</div>
					</div>
					<div class="layui-colla-item">
						<h2 class="layui-colla-title">其他事项</h2>
						<div class="layui-colla-content">...</div>
					</div>
				</div>
				<div id="admin-info" class="layui-collapse layui-hide">
					<div class="layui-colla-item">
						<h2 class="layui-colla-title">管理员通知</h2>
						<div class="layui-colla-content layui-show">........</div>
					</div>
					<div class="layui-colla-item">
						<h2 class="layui-colla-title">系统使用手册</h2>
						<div class="layui-colla-content">内容区域</div>
					</div>
				</div>
			</div>

			<div class="layui-footer ">
				<!-- 底部固定区域 -->
				军事理论考试系统 by 
			</div>
		</div>
		<div id="loginWindows" class="layui-hide">
			<div style="width: 450px;margin-top:30px;">
				<form class="layui-form" >
					<div class="layui-form-item">
						<label class="layui-form-label">用户名</label>
						<div class="layui-input-block">
							<input id="username" type="text" name="username" required  lay-verify="required" placeholder="请输入用户名" autocomplete="off" class="layui-input">
						</div>
					</div>
					<div class="layui-form-item">
						<label class="layui-form-label">密码</label>
						<div class="layui-input-block">
							<input id="password" type="password" name="password" required lay-verify="required" placeholder="请输入密码" autocomplete="off" class="layui-input">
						</div>
					</div>
				<div class="layui-form-item">
					<div class="layui-input-block">
						<button id="submit" class="layui-btn" lay-submit lay-filter="form-submit">立即提交</button>
						<button type="reset" class="layui-btn layui-btn-primary">重置</button>
					</div>
				</div>
				</form>
			</div>
		</div>
		<script src="../layui/layui.js"></script>
		<script> 
			$(document).ready(function() {
				if($.cookie('userID')!=null){
					$("#user-info").removeClass("layui-hide");
					$("#user-name").text($.cookie('username'));
				}else{
					$("#login").removeClass("layui-hide");
				}
			});

			//loginDom
			var loginDom=$("#loginWindows").html();

			//监听侧边栏
			layui.use('element', function(){
				var element = layui.element;
				//一些事件监听
				element.on('nav(left-nav)', function(elem){
					if(elem[0].id=="teacher-msg"){
						$("#teacher-info").removeClass("layui-hide");
						$("#admin-info").addClass("layui-hide");
					}else{
						$("#teacher-info").addClass("layui-hide");
						$("#admin-info").removeClass("layui-hide");
					}
				});
			});

			//登录窗口
			$("#login a").click(function(){
				layui.use('layer', function(){
					var layer = layui.layer;
					layer.open({
						type:1,
						content:loginDom,
						title:"用户登录",
						area:["500px","250px"]
					});
				}); 
			});

			layui.use('form', function(){
				var form =layui.form;
				form.on('submit(form-submit)', function(){
					var username=$(":text").val();
					var password=$(":password").val();
					//md5加密
					password=$.md5(password);
					var loginCode=-1;
					$.ajax({
						type:"POST",
						url:"/api/login",
						dataType:"json",
						data:{
							"username":username,
							"password":password
						},
						async:false,
						success:function(resp){
							var data=JSON.parse(resp);
							if(data["loginCode"]!=undefined){
								loginCode=data["loginCode"];
							}
						}

					})
					var layer=layui.layer;
					if(loginCode==-1){
						layer.msg("服务器出错");
					}else if(loginCode==0){
						layer.msg("用户名或密码错误");
					}else{
						layer.msg("登录成功");
					}
					return false; //阻止表单跳转。如果需要表单跳转，去掉这段即可。
				});
				//退出登录
				$("#logout").click(function(){
					$.ajax({
						type:"POST",
						url:"/api/logout",
						success:function(resp){
						}
					})
				})
			});
		</script> 
	</body>
</html>
